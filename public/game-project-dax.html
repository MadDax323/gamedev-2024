<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Roguelike Game</title>
    <style>
        body {
            font-family: monospace;
            background-color: #000;
            color: #0f0;
            line-height: 1.2;
            padding: 10px;
        }

        #game {
            white-space: pre;
            font-size: 8px; /* Reduced font size for better fit */
            border: 1px solid #0f0;
            padding: 10px;
            line-height: 1.2;
            margin-bottom: 60px; /* Space for inventory */
        }

        #inventory {
            border: 1px solid #0f0;
            padding: 5px;
            position: fixed;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-gap: 5px;
        }

        .slot {
            border: 1px solid #0f0;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.7);
            color: #0f0;
        }

        #items {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
            border-top: 1px solid #0f0;
            color: #FFFFFF;
        }

        .item {
            cursor: pointer;
        }

        #message {
            color: #FF0000;
            text-align: center;
            position: fixed;
            top: 0;
            left: 10px;
            right: 10px;
        }
    </style>
</head>
<body>
    <h1>ASCII Roguelike Game</h1>
    <div id="game"></div>
    <div id="message"></div>

    <div id="inventory">
        <div class="slot" id="headSlot">Head</div>
        <div class="slot" id="chestSlot">Chest</div>
        <div class="slot" id="legsSlot">Legs</div>
        <div class="slot" id="beltSlot">Belt</div>
        <div class="slot" id="feetSlot">Feet</div>
        <div class="slot" id="handsSlot">Hands</div>
    </div>

    <script>
        // Game and Inventory Configuration
        const width = 250; 
        const height = 250; 
        const playerSymbol = '@';
        const wallSymbol = '#';
        const doorSymbol = '+';
        const floorSymbol = '.';
        const exitSymbol = 'E';
        const enemySymbols = ['G', 'S', 'W']; // Goblin, Skeleton, Witch
        const unexploredSymbol = ' ';
        const inventorySlots = {
            head: null,
            chest: null,
            legs: null,
            belt: null,
            feet: null,
            hands: null,
        };
        const items = [];
        const playerBaseHealth = 100;
        const playerBasePower = 5;
        const playerBaseDefense = 2;

        let playerHealth = playerBaseHealth; 
        let playerPower = playerBasePower; 
        let playerDefense = playerBaseDefense;

        let gameMap = []; 
        let fogMap = []; // For fog of war effect
        let playerPos = { x: 1, y: 1 };
        let enemies = [];

        // Enemy configurations
        const enemyStats = [
            { name: "Goblin", health: 50, damage: 10, symbol: 'G' },
            { name: "Skeleton", health: 60, damage: 12, symbol: 'S' },
            { name: "Witch", health: 40, damage: 15, symbol: 'W' }
        ];

        // Items and loot
        const lootItems = [
            { name: 'Gold Coin', type: 'item' },
            { name: 'Healing Potion', type: 'item' },
            { name: 'Iron Sword', type: 'hands', power: 5 },
            { name: 'Leather Armor', type: 'chest', defense: 3 },
            { name: 'Wooden Shield', type: 'back', defense: 2 }
        ];

        // Initialize game environment
        function initializeMap() {
            gameMap = Array.from({ length: height }, () => Array(width).fill(unexploredSymbol));
            fogMap = Array.from({ length: height }, () => Array(width).fill(true)); // Default to fogged

            // Create rooms with walls and doors
            createRoom(2, 2, 20, 20); // Room 1
            createRoom(25, 2, 20, 20); // Room 2
            createRoom(2, 25, 20, 20); // Room 3
            createRoom(25, 25, 20, 20); // Room 4
            createRoom(2, 50, 40, 40); // Room 5
            createRoom(50, 2, 30, 30); // Room 6
            createRoom(80, 20, 50, 15); // Room 7
            createRoom(120, 80, 30, 30); // Room 8
            createRoom(160, 160, 50, 50); // Room 9

            spawnEnemies(15);
            spawnChests(5);
        }

        function createRoom(x, y, width, height) {
            for (let i = y; i < y + height; i++) {
                for (let j = x; j < x + width; j++) {
                    if (i === y || i === y + height - 1 || j === x || j === x + width - 1) {
                        gameMap[i][j] = wallSymbol; // Walls
                    } else {
                        gameMap[i][j] = floorSymbol; // Floors
                    }
                }
            }
            // Place doors
            const doorX = x + Math.floor(Math.random() * (width - 2)) + 1;
            const doorY = y;

            gameMap[doorY][doorX] = doorSymbol; // Top door
            fogMap[doorY][doorX] = false; // Doors should not be fogged
        }

        function spawnEnemies(count) {
            const availableTiles = [];
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    if (gameMap[y][x] === floorSymbol) {
                        availableTiles.push({ x, y });
                    }
                }
            }

            for (let i = 0; i < count; i++) {
                const enemy = enemyStats[Math.floor(Math.random() * enemyStats.length)];
                const position = availableTiles.splice(Math.floor(Math.random() * availableTiles.length), 1)[0];

                gameMap[position.y][position.x] = enemy.symbol;
                enemies.push({ ...enemy, x: position.x, y: position.y });
            }
        }

        function spawnChests(count) {
            const availableTiles = [];
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    if (gameMap[y][x] === floorSymbol) {
                        availableTiles.push({ x, y });
                    }
                }
            }

            for (let i = 0; i < count; i++) {
                const position = availableTiles.splice(Math.floor(Math.random() * availableTiles.length), 1)[0];
                gameMap[position.y][position.x] = 'C';
            }
        }

        function draw() {
            let output = '';
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    if (x === playerPos.x && y === playerPos.y) {
                        output += playerSymbol; 
                    } else if (!fogMap[y][x]) {
                        output += gameMap[y][x]; // Show visible tiles
                    } else {
                        output += unexploredSymbol; // Fog of war tiles
                    }
                }
                output += '\n';
            }
            document.getElementById('game').textContent = output;
        }

        function movePlayer(dx, dy) {
            const newX = playerPos.x + dx;
            const newY = playerPos.y + dy;

            if (gameMap[newY] && gameMap[newY][newX] !== wallSymbol) {
                const tile = gameMap[newY][newX];
                if (tile === exitSymbol) {
                    window.location.href = "https://example.com"; // Replace with your desired endpoint
                } else if (enemySymbols.includes(tile)) {
                    const enemy = enemies.find(e => e.symbol === tile);
                    startCombat(enemy);
                } else if (tile === 'C') {
                    openChest(newX, newY);
                }

                // Reveal fog of war in a certain radius around the player
                revealFog(newX, newY);
                
                playerPos.x = newX;
                playerPos.y = newY;
                draw();
            }
        }

        function revealFog(x, y) {
            const revealDistance = 5; // The radius to reveal; increase for wider visibility
            for (let dy = -revealDistance; dy <= revealDistance; dy++) {
                for (let dx = -revealDistance; dx <= revealDistance; dx++) {
                    const checkX = x + dx;
                    const checkY = y + dy;
                    if (checkX >= 0 && checkX < width && checkY >= 0 && checkY < height) {
                        fogMap[checkY][checkX] = false; // Mark this tile as revealed
                    }
                }
            }
        }

        function startCombat(enemy) {
            document.getElementById('message').textContent = `A wild ${enemy.name} appears!`;
            combatTurn(enemy);
        }

        function combatTurn(enemy) {
            const damageToEnemy = Math.floor(Math.random() * 10) + playerPower; // Player damage
            enemy.health -= damageToEnemy;

            document.getElementById('message').textContent += ` You hit the ${enemy.name} for ${damageToEnemy} damage!`;
            if (enemy.health <= 0) {
                document.getElementById('message').textContent += ` You defeated the ${enemy.name}!`;
                gameMap[enemy.y][enemy.x] = floorSymbol; // Reset to floor
                enemies = enemies.filter(e => e !== enemy);
                return;
            }

            const damageToPlayer = Math.max(0, enemy.damage - playerDefense);
            document.getElementById('message').textContent += ` The ${enemy.name} hit you back for ${damageToPlayer} damage!`;
            playerHealth -= damageToPlayer;

            if (playerHealth <= 0) {
                document.getElementById('message').textContent += ` You have been defeated! Game Over.`;
                gameOver();
            }
        }

        function openChest(x, y) {
            const loot = lootItems[Math.floor(Math.random() * lootItems.length)];
            document.getElementById('message').textContent = `You opened a chest and found a ${loot.name}!`;
            items.push(loot);
            drawInventory();

            // Remove the chest from the map
            gameMap[y][x] = floorSymbol; // Change chest to floor
        }

        function drawInventory() {
            const itemList = document.getElementById('items');
            itemList.innerHTML = '';
            items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.textContent = item.name;
                itemDiv.className = 'item';
                itemDiv.onclick = () => equipItem(item);
                itemList.appendChild(itemDiv);
            });
        }

        function equipItem(item) {
            const slotType = item.type;
            if (inventorySlots[slotType] === null) {
                inventorySlots[slotType] = item;
                updatePlayerStats(item);
                drawInventory();
                updateSlots();
            }
        }

        function updatePlayerStats(item) {
            if (item.power) {
                playerPower += item.power;
            }
            if (item.defense) {
                playerDefense += item.defense;
            }
        }

        function updateSlots() {
            for (const [type, item] of Object.entries(inventorySlots)) {
                document.getElementById(type + 'Slot').textContent = item ? item.name : type.charAt(0).toUpperCase() + type.slice(1);
            }
        }

        window.addEventListener("keydown", (e) => {
            switch (e.key) {
                case "ArrowUp":
                    movePlayer(0, -1);
                    break;
                case "ArrowDown":
                    movePlayer(0, 1);
                    break;
                case "ArrowLeft":
                    movePlayer(-1, 0);
                    break;
                case "ArrowRight":
                    movePlayer(1, 0);
                    break;
                case "i":
                    toggleInventory();
                    break;
            }
            moveEnemies();
        });

        function toggleInventory() {
            const inventory = document.getElementById('inventory');
            inventory.style.display = (inventory.style.display === 'none' || inventory.style.display === '') ? 'grid' : 'none';
            if (inventory.style.display === 'grid') {
                document.getElementById('message').textContent = 'Inventory Opened';
            } else {
                document.getElementById('message').textContent = '';
            }
        }

        function moveEnemies() {
            enemies.forEach(enemy => {
                const distX = enemy.x - playerPos.x;
                const distY = enemy.y - playerPos.y;
                if (Math.abs(distX) <= 5 && Math.abs(distY) <= 5) { // Enemy sees the player
                    if (distX > 0) {
                        enemy.x--;
                    } else if (distX < 0) {
                        enemy.x++;
                    }
                    if (distY > 0) {
                        enemy.y--;
                    } else if (distY < 0) {
                        enemy.y++;
                    }
                    gameMap[enemy.y][enemy.x] = enemy.symbol; // Move enemy on the map
                }
            });
        }

        function gameOver() {
            document.getElementById('game').textContent = "Game Over!";
            document.removeEventListener("keydown", onKeyPress);
        }

        // Initialize the game
        initializeMap();
        draw();
    </script>
</body>
</html>
