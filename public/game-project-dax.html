<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improved Roguelike Game</title>
    <style>
        body {
            font-family: monospace;
            background-color: #000;
            color: #0f0;
            margin: 0;
            padding: 10px;
        }

        #game {
            white-space: pre;
            font-size: 14px;
            overflow: auto;
            max-height: 70vh;
            border: 1px solid #0f0;
            padding: 10px;
        }

        #inventory {
            margin-top: 10px;
            border: 1px solid #0f0;
            padding: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .slot {
            border: 1px solid #0f0;
            padding: 5px;
            text-align: center;
            flex: 1 0 120px;
            background-color: rgba(0, 0, 0, 0.9);
            color: #0f0;
        }

        .slot.equipped {
            background-color: #00ff00;
            color: #000;
        }

        #message {
            margin-top: 10px;
            color: #ff0;
        }
    </style>
</head>
<body>
    <h1>Improved Roguelike Game</h1>
    <div id="game"></div>
    <div id="inventory"></div>
    <div id="message"></div>

    <script>
        // Game configuration
        const MAP_WIDTH = 50;
        const MAP_HEIGHT = 20;
        const PLAYER_SYMBOL = '@';
        const WALL_SYMBOL = '#';
        const FLOOR_SYMBOL = '.';
        const ENEMY_SYMBOL = 'E';
        const EXIT_SYMBOL = 'X';
        const CHEST_SYMBOL = 'C';

        let gameMap = [];
        let playerPos = { x: 5, y: 5 };
        let enemies = [];
        let inventory = [];
        let equippedItem = null;
        let gameMessage = "";

        // Procedural map generation
        function generateMap() {
            gameMap = Array.from({ length: MAP_HEIGHT }, () =>
                Array.from({ length: MAP_WIDTH }, () => WALL_SYMBOL)
            );

            // Generate random rooms
            for (let i = 0; i < 5; i++) {
                const roomWidth = Math.floor(Math.random() * 8) + 4;
                const roomHeight = Math.floor(Math.random() * 6) + 4;
                const roomX = Math.floor(Math.random() * (MAP_WIDTH - roomWidth - 1)) + 1;
                const roomY = Math.floor(Math.random() * (MAP_HEIGHT - roomHeight - 1)) + 1;

                for (let y = roomY; y < roomY + roomHeight; y++) {
                    for (let x = roomX; x < roomX + roomWidth; x++) {
                        gameMap[y][x] = FLOOR_SYMBOL;
                    }
                }
            }

            // Place exit
            const exitX = Math.floor(Math.random() * MAP_WIDTH);
            const exitY = Math.floor(Math.random() * MAP_HEIGHT);
            if (gameMap[exitY][exitX] === FLOOR_SYMBOL) {
                gameMap[exitY][exitX] = EXIT_SYMBOL;
            }
        }

        function spawnEnemies(count) {
            enemies = [];
            for (let i = 0; i < count; i++) {
                const x = Math.floor(Math.random() * MAP_WIDTH);
                const y = Math.floor(Math.random() * MAP_HEIGHT);
                if (gameMap[y][x] === FLOOR_SYMBOL) {
                    enemies.push({ x, y, health: 20 });
                    gameMap[y][x] = ENEMY_SYMBOL;
                }
            }
        }

        function spawnChests(count) {
            for (let i = 0; i < count; i++) {
                const x = Math.floor(Math.random() * MAP_WIDTH);
                const y = Math.floor(Math.random() * MAP_HEIGHT);
                if (gameMap[y][x] === FLOOR_SYMBOL) {
                    gameMap[y][x] = CHEST_SYMBOL;
                }
            }
        }

        function drawMap() {
            let output = '';
            for (let y = 0; y < MAP_HEIGHT; y++) {
                for (let x = 0; x < MAP_WIDTH; x++) {
                    if (x === playerPos.x && y === playerPos.y) {
                        output += PLAYER_SYMBOL;
                    } else {
                        output += gameMap[y][x];
                    }
                }
                output += '\n';
            }
            document.getElementById('game').textContent = output;
            document.getElementById('message').textContent = gameMessage;
        }

        function movePlayer(dx, dy) {
            const newX = playerPos.x + dx;
            const newY = playerPos.y + dy;

            if (gameMap[newY][newX] === WALL_SYMBOL) return;

            const tile = gameMap[newY][newX];

            if (tile === EXIT_SYMBOL) {
                gameMessage = "You found the exit! Victory!";
                drawMap();
                return;
            } else if (tile === CHEST_SYMBOL) {
                openChest();
                gameMap[newY][newX] = FLOOR_SYMBOL;
            } else if (tile === ENEMY_SYMBOL) {
                startCombat(newX, newY);
                return;
            }

            playerPos = { x: newX, y: newY };
            drawMap();
        }

        function openChest() {
            const loot = { name: "Sword", type: "weapon", power: 10 };
            inventory.push(loot);
            gameMessage = `You found a ${loot.name}!`;
            updateInventory();
        }

        function updateInventory() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            inventory.forEach((item, index) => {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.textContent = item.name;
                slot.onclick = () => equipItem(index);
                inventoryDiv.appendChild(slot);
            });
        }

        function equipItem(index) {
            equippedItem = inventory[index];
            gameMessage = `Equipped ${equippedItem.name}!`;
            updateInventory();
        }

        function startCombat(x, y) {
            const enemy = enemies.find(e => e.x === x && e.y === y);
            gameMessage = "You encountered an enemy!";
            enemy.health -= equippedItem ? equippedItem.power : 5;
            if (enemy.health <= 0) {
                gameMessage += " You defeated the enemy!";
                gameMap[y][x] = FLOOR_SYMBOL;
                enemies = enemies.filter(e => e !== enemy);
            }
            drawMap();
        }

        // Initialize the game
        generateMap();
        spawnEnemies(5);
        spawnChests(3);
        drawMap();

        window.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowUp': movePlayer(0, -1); break;
                case 'ArrowDown': movePlayer(0, 1); break;
                case 'ArrowLeft': movePlayer(-1, 0); break;
                case 'ArrowRight': movePlayer(1, 0); break;
            }
        });
    </script>
</body>
</html>
