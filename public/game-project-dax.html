<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Roguelike Game</title>
    <style>
        body {
            font-family: monospace;
            background-color: #000;
            color: #0f0;
            line-height: 1.2;
            padding: 10px;
        }

        #game {
            white-space: pre;
            font-size: 16px;
            border: 1px solid #0f0;
            padding: 10px;
            line-height: 1.2;
        }

        #inventory {
            border: 1px solid #0f0;
            padding: 5px;
            display: none; /* Hidden until opened */
            position: fixed;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .slot {
            border: 1px solid #0f0;
            width: 3ch;
            height: 3ch;
            display: inline-block;
            vertical-align: top;
            text-align: center;
        }

        #items { 
            margin-top: 10px; 
            max-height: 150px; 
            overflow-y: auto; 
            border-top: 1px solid #0f0; 
        }

        .item {
            cursor: pointer;
        }

        #message {
            color: #FF0000;
            text-align: center;
        }
    </style>
</head>

<body>
    <h1>ASCII Roguelike Game</h1>
    <div id="game"></div>
    <div id="message"></div>

    <div id="inventory">
        <h3>Inventory</h3>
        <div>
            <span class="slot" id="headSlot"></span>
            <span class="slot" id="chestSlot"></span>
            <span class="slot" id="legsSlot"></span>
            <span class="slot" id="beltSlot"></span>
            <span class="slot" id="feetSlot"></span>
            <span class="slot" id="handsSlot"></span>
            <span class="slot" id="backSlot"></span>
        </div>
        <div id="items"></div>
    </div>

    <script>
        // Game and Inventory Configuration
        const width = 40; 
        const height = 20; 
        const playerSymbol = '@';
        const wallSymbol = '#';
        const floorSymbol = '.';
        const exitSymbol = 'E';
        const chestSymbol = 'C';
        const unexploredSymbol = ' ';
        const inventorySlots = {
            head: null,
            chest: null,
            legs: null,
            belt: null,
            feet: null,
            hands: null,
            back: null,
        };
        const items = [];
        const allItems = [
            { name: 'Leather Helmet', type: 'head' },
            { name: 'Iron Chestplate', type: 'chest' },
            { name: 'Leather Boots', type: 'feet' },
            { name: 'Iron Leggings', type: 'legs' },
            { name: 'Wool Belt', type: 'belt' },
            { name: 'Wooden Shield', type: 'back' },
            { name: 'Iron Sword', type: 'hands' },
            { name: 'Healing Potion', type: 'item' }
        ];

        let playerPos = { x: 0, y: 0 };
        let gameMap = [];
        let visibilityMap = [];
        let currentLevel = 0; 

        // Initialize Game
        function initializeMap() {
            gameMap = Array.from({ length: height }, () => wallSymbol.repeat(width));
        }

        function initializeVisibility() {
            visibilityMap = Array.from({ length: height }, () => unexploredSymbol.repeat(width));
            visibilityMap[playerPos.y] = visibilityMap[playerPos.y].substring(0, playerPos.x) + floorSymbol.repeat(width - playerPos.x);
        }

        function createRoom(x, y, roomWidth, roomHeight) {
            for (let i = x; i < x + roomWidth; i++) {
                for (let j = y; j < y + roomHeight; j++) {
                    gameMap[j] = gameMap[j].substring(0, i) + floorSymbol + gameMap[j].substring(i + 1);
                }
            }
        }

        function connectRooms(room1, room2) {
            const x1 = room1.x + Math.floor(room1.width / 2);
            const y1 = room1.y + Math.floor(room1.height / 2);
            const x2 = room2.x + Math.floor(room2.width / 2);
            const y2 = room2.y + Math.floor(room2.height / 2);

            if (Math.random() < 0.5) {
                drawHorizontalHallway(x1, x2, y1);
                drawVerticalHallway(y1, y2, x2);
            } else {
                drawVerticalHallway(y1, y2, x1);
                drawHorizontalHallway(x1, x2, y2);
            }
        }

        function drawHorizontalHallway(x1, x2, y) {
            for (let x = Math.min(x1, x2); x <= Math.max(x1, x2); x++) {
                gameMap[y] = gameMap[y].substring(0, x) + floorSymbol + gameMap[y].substring(x + 1);
            }
        }

        function drawVerticalHallway(y1, y2, x) {
            for (let y = Math.min(y1, y2); y <= Math.max(y1, y2); y++) {
                gameMap[y] = gameMap[y].substring(0, x) + floorSymbol + gameMap[y].substring(x + 1);
            }
        }

        function generateRandomMap() {
            initializeMap();
            const rooms = [];

            // Room generation logic...
            const maxRooms = 10;
            while (rooms.length < maxRooms) {
                const roomWidth = Math.floor(Math.random() * 4) + 3;
                const roomHeight = Math.floor(Math.random() * 4) + 3;
                const x = Math.floor(Math.random() * (width - roomWidth - 1)) + 1;
                const y = Math.floor(Math.random() * (height - roomHeight - 1)) + 1;

                const newRoom = { x, y, width: roomWidth, height: roomHeight };

                let overlap = rooms.some(otherRoom => 
                    x < otherRoom.x + otherRoom.width &&
                    x + roomWidth > otherRoom.x &&
                    y < otherRoom.y + otherRoom.height &&
                    y + roomHeight > otherRoom.y
                );

                if (!overlap) {
                    createRoom(x, y, roomWidth, roomHeight);
                    rooms.push(newRoom);
                    if (rooms.length > 1) connectRooms(rooms[rooms.length - 2], newRoom);
                }
            }

            // Place an exit
            const lastRoom = rooms[rooms.length - 1];
            const exitX = lastRoom.x + Math.floor(lastRoom.width / 2);
            const exitY = lastRoom.y + Math.floor(lastRoom.height / 2);
            gameMap[exitY] = gameMap[exitY].substring(0, exitX) + exitSymbol + gameMap[exitY].substring(exitX + 1);

            // Place a chest randomly
            const chestX = Math.floor(Math.random() * width);
            const chestY = Math.floor(Math.random() * height);
            gameMap[chestY] = gameMap[chestY].substring(0, chestX) + chestSymbol + gameMap[chestY].substring(chestX + 1);
            items.push(randomItem()); // Add random item to inventory for the demo

            playerPos = { x: Math.floor(width / 2), y: Math.floor(height / 2) };
            gameMap[playerPos.y] = gameMap[playerPos.y].substring(0, playerPos.x) + floorSymbol + gameMap[playerPos.y].substring(playerPos.x + 1);
        }

        function randomItem() {
            return allItems[Math.floor(Math.random() * allItems.length)];
        }

        function draw() {
            let output = '';
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    if (x === playerPos.x && y === playerPos.y) {
                        output += playerSymbol; 
                    } else if (visibilityMap[y][x] !== unexploredSymbol) {
                        output += gameMap[y][x]; 
                    } else {
                        output += unexploredSymbol; 
                    }
                }
                output += '\n';
            }
            document.getElementById('game').textContent = output;
        }

        function movePlayer(dx, dy) {
            const newX = playerPos.x + dx;
            const newY = playerPos.y + dy;

            if (gameMap[newY][newX] !== wallSymbol) {
                if (gameMap[newY][newX] === exitSymbol) {
                    currentLevel++;
                    if (currentLevel < 5) {
                        generateRandomMap();
                    } else {
                        generateBossArena();
                    }
                } else if (gameMap[newY][newX] === chestSymbol) {
                    pickUpItems();
                }
                playerPos.x = newX;
                playerPos.y = newY;

                // Update visibility
                revealSurroundings();
                draw();
            }
        }

        function revealSurroundings() {
            const revealDistance = 2; 
            for (let dy = -revealDistance; dy <= revealDistance; dy++) {
                for (let dx = -revealDistance; dx <= revealDistance; dx++) {
                    const checkX = playerPos.x + dx;
                    const checkY = playerPos.y + dy;
                    if (checkX >= 0 && checkX < width && checkY >= 0 && checkY < height) {
                        visibilityMap[checkY] = visibilityMap[checkY].substring(0, checkX) + gameMap[checkY][checkX] + visibilityMap[checkY].substring(checkX + 1);
                    }
                }
            }
        }

        function pickUpItems() {
            const newItem = randomItem();
            items.push(newItem);
            drawInventory();
            document.getElementById('message').textContent = `Picked up ${newItem.name}!`;
        }

        function drawInventory() {
            const itemList = document.getElementById('items');
            itemList.innerHTML = '';
            items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.textContent = item.name;
                itemDiv.className = 'item';
                itemDiv.onclick = () => equipItem(item);
                itemDiv.ondblclick = () => useItem(item);
                itemList.appendChild(itemDiv);
            });
        }

        function equipItem(item) {
            const slotType = item.type;
            if (inventorySlots[slotType] === null) {
                inventorySlots[slotType] = item;
                drawInventory();
                updateSlots();
            }
        }

        function updateSlots() {
            for (const [type, item] of Object.entries(inventorySlots)) {
                document.getElementById(type + 'Slot').textContent = item ? item.name : '';
            }
        }

        function useItem(item) {
            if (item.name === 'Healing Potion') {
                document.getElementById('message').textContent = `You used a healing potion!`;
                items.splice(items.indexOf(item), 1); // Remove from inventory
                drawInventory();
            }
        }

        function generateBossArena() {
            // Create a 10x10 arena
            const arenaWidth = 10;
            const arenaHeight = 10;
            let arenaMap = Array(arenaHeight).fill('#'.repeat(arenaWidth));
            playerPos.x = Math.floor(arenaWidth / 2);
            playerPos.y = Math.floor(arenaHeight / 2);
            arenaMap[playerPos.y] = arenaMap[playerPos.y].substring(0, playerPos.x) + floorSymbol + arenaMap[playerPos.y].substring(playerPos.x + 1);
            gameMap = arenaMap;
            revealSurroundings();
            draw();
        }

        window.addEventListener("keydown", (e) => {
            switch (e.key) {
                case "ArrowUp":
                    movePlayer(0, -1);
                    break;
                case "ArrowDown":
                    movePlayer(0, 1);
                    break;
                case "ArrowLeft":
                    movePlayer(-1, 0);
                    break;
                case "ArrowRight":
                    movePlayer(1, 0);
                    break;
                case "i":
                    toggleInventory();
                    break;
                case "r":
                    if (gameMap[playerPos.y][playerPos.x] === chestSymbol) {
                        pickUpItems();
                    }
                    break;
            }
        });

        function toggleInventory() {
            const inventory = document.getElementById('inventory');
            inventory.style.display = inventory.style.display === 'none' ? 'block' : 'none';
        }

        // Initialize the game
        generateRandomMap();
        initializeVisibility();
        draw();
    </script>
</body>

</html>
